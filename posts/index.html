<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Tbistr blog</title><meta name=keywords content><meta name=description content="Posts - Tbistr blog"><meta name=author content="tbistr"><link rel=canonical href=https://tbistr.github.io/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=icon href=https://tbistr.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tbistr.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tbistr.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://tbistr.github.io/favicon/apple-touch-icon.png><link rel=mask-icon href=https://tbistr.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><link rel=alternate type=application/rss+xml href=https://tbistr.github.io/posts/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-5JG1SFWT3X"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-5JG1SFWT3X',{anonymize_ip:!1})}</script><meta property="og:title" content="Posts"><meta property="og:description" content="tbistr's blog"><meta property="og:type" content="website"><meta property="og:url" content="https://tbistr.github.io/posts/"><meta property="og:image" content="https://tbistr.github.io/images/funny_face.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tbistr.github.io/images/funny_face.jpg"><meta name=twitter:title content="Posts"><meta name=twitter:description content="tbistr's blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tbistr.github.io/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://tbistr.github.io/ accesskey=h title="Tbistr blog (Alt + H)">Tbistr blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://tbistr.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://tbistr.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://tbistr.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://tbistr.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://tbistr.github.io/>Home</a></div><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2>DockerComposeで環境変数のエイリアスを作りたい</h2></header><section class=entry-content><p>経緯 相変わらずDocker上のMySQLをいじっている。
MySQLサーバに対して、毎回コンテナに入ってmysqlプロンプトを出してコマンドを打つのがめんどくさいので、webベースのGUIサーバを追加することにした。 このとき、.envで指定しているMySQL用のユーザ情報について、同じ値を別の名前で環境変数として指定する必要があった。
環境 docker-composeファイルは以下の通り。
version: '3.8' services: db: container_name: db image: mysql:8.0 environment: - LANG=ja_JP.UTF-8 tty: true volumes: - type: volume source: test_volume target: /var/lib/mysql networks: - test_network volumes: test_volume: name: test_volume networks: test_network: external: true .envはこの内容。
MYSQL_DATABASE=test_database MYSQL_USER=test_user MYSQL_PASSWORD=password MYSQL_ROOT_PASSWORD=root_password 課題 今の環境に、phpmyadminというMySQLのGUIツールを新しいサービスとして導入する。 具体的に以下の内容を追加したい。
db-gui: container_name: db-gui image: phpmyadmin/phpmyadmin environment: - LANG=ja_JP.UTF-8 tty: true ports: - 8080:80 depends_on: - db networks: - test_network このとき、phpmyadminコンテナには環境変数PMA_HOSTS, PMA_USER, PMA_PASSWORDを渡して接続先と認証の情報を教える必要がある。 しかし、PMA_HOSTSはサービス名(db)を直書きすれば良いとして(networkが設定されてるので、サービス名←→アドレスができる)、他の2つの値は.envのMYSQL_USER, MYSQL_PASSWORDと同一である。...</p></section><footer class=entry-footer><span title="2022-08-23 12:10:26 +0000 UTC">August 23, 2022</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;tbistr</footer><a class=entry-link aria-label="post link to DockerComposeで環境変数のエイリアスを作りたい" href=https://tbistr.github.io/posts/tech/docker-compose%E3%81%A7%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8A%E3%81%9F%E3%81%84/></a></article><article class=post-entry><header class=entry-header><h2>MySQLのチュートリアルでコケた</h2></header><section class=entry-content><p>流れ 今作ってるbotでMySQLを使いたくなったので、使ってみる。 作ってるのはhttps://github.com/tbistr/gs-linker。
参考 MySQLのチュートリアルサイト? https://www.mysqltutorial.org/getting-started-with-mysql/ を参考にした。
環境はVagrantで作った。 Boxはbento/ubuntu-20.04。
インストール チュートリアルサイトでのインストールの手順では、 sudo mysql_secure_installationでどんなパスワードを設定しても
... Failed! Error: SET PASSWORD has no significance for user 'root'@'localhost' as the authentication method used doesn't store authentication data in the MySQL server. Please consider using ALTER USER instead if you want to change authentication parameters. のエラーで失敗する。
そのため、sudo mysql_secure_installationの前に、
sudo mysql mysql> ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '適当なパスワード'; mysql> exit を実行した。
あとは手順通り、すべてyでOK。
一応確認、
sudo mysql -u root -p mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | +--------------------+ 4 rows in set (0....</p></section><footer class=entry-footer><span title="2022-08-19 13:48:10 +0000 UTC">August 19, 2022</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;tbistr</footer><a class=entry-link aria-label="post link to MySQLのチュートリアルでコケた" href=https://tbistr.github.io/posts/tech/mysql_tutorial/></a></article><article class=post-entry><header class=entry-header><h2>Virtualbox Manager (GUI)が起動しないバグと解決方法</h2></header><section class=entry-content><p>概要 原因はUSBでつながっていたXInputのコントローラ。 デバイスを抜くことで解決。
状況 症状 VirtualboxのGUIが起動しない vagrant upが失敗する VBoxManage.exeコマンドに応答がない helpは表示できるが、vmのリスト等は出ない 環境 i7-12700 32gb windows11 pro virtualbox 6.1.32 chocolateyでインストール wsl, dockerがインストールされている ハイパーバイザプラットフォーム有効化済み 確認したこと、やってみたこと タスクマネージャの確認 virtualboxの再インストール vagrantの再インストール OSのクリーンインストール タスクマネージャの確認 「バックグラウンドプロセス」のタブにこの3つのプロセスが存在した。
Virtualbox Interface Virtualbox Global Interface Virtualbox Manager 本来は、Virtualbox Managerは「アプリ」のタブにあるべき。 起動を試みるたびに、Virtualbox Managerは増えていき、ゾンビプロセスになった。
virtualbox, vagrantの再インストール chocolatey版、msiインストーラ版両方試したが効果なし。
OSのクリーンインストール しばらくは問題が起きなくなったが、ある日突然再発。
原因と解決方法 VM起動時にエラーが発生し、いつもどおり原因をググっていたところ、同じような問題がOracleのフォーラムに投稿されていることに気がついた。
https://forums.virtualbox.org/viewtopic.php?t=97261
昨年10月に、このような投稿があった。
Re: GUI not appearing
Postby LeonJi » 4....</p></section><footer class=entry-footer><span title="2022-04-26 07:35:27 +0000 UTC">April 26, 2022</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;tbistr</footer><a class=entry-link aria-label="post link to Virtualbox Manager (GUI)が起動しないバグと解決方法" href=https://tbistr.github.io/posts/tech/vb_usb_bug/></a></article><article class=post-entry><header class=entry-header><h2>texlive2021の最強環境を作ったよ</h2></header><section class=entry-content><p>概要 卒論のために久しぶりにTeX環境を作る必要があったので、TeX Liveがfullでインストールされたコンテナイメージを探していたのですが、無かったので作りました。 通常のインストール手順ではハマるポイントがあったのでパッケージマネージャを使わない方法でインストールしました。
devcontainer化することで、vscodeから立ち上げるだけで補完、プレビューが使えるようになっています。
devcontainer devcontainerとは、vscodeの（拡張）機能の1つで、これを利用することで用意したコンテナの中にワークスペースフォルダをマウントし、コンテナ内のコマンド、環境を使うことができます。 また、拡張機能、設定についても指定したものを使うことができます（ローカルのvscodeにはインストールされません）。 これにより、環境の分離、チーム内での共通化ができます。
参考：devcontainerのチュートリアル
ネット上に存在するTeX用Dockerイメージ ネット上には、フルインストール版、日本語に必要なモジュールに限定した版の両方について、様々なイメージが存在しています。 しかし、日本語環境がうまく入らない、texindex（フォーマッタ）が動作しないなど、日本語環境で常用するには不具合が発生しました。 執筆中に試してみたら、公式が配布しているtexlive/texliveイメージはちゃんと全部動きました。。。まあ、見なかったことにします。 また、fullと謳っていながら実際にはモジュールに不足があるイメージもあります（主に日本語関係のモジュールがない）。
制作内容 全容はGithubのリポジトリから参照できます。
tex.profile texを非対話的に（ビルド時にユーザーがオプション等を選択しない）インストールするのに必要な設定ファイルです。 今回は、このファイルによるスキーマ指定がしたかったため、aptは使わずに、ソースからインストールしています。
selected_scheme scheme-fullでfullバージョンを指定しています。
その他で肝要な部分は、option_doc 0とoption_src 0です。 fullでインストールすると、ドキュメントとソースを含むだけで2GB近く消費してしまいます。 そのため、このオプションで除外しておきます。
selected_scheme scheme-full TEXDIR /opt/texlive/2021 TEXMFCONFIG ~/.texlive2021/texmf-config TEXMFHOME ~/texmf TEXMFLOCAL /opt/texlive/texmf-local TEXMFSYSCONFIG /opt/texlive/2021/texmf-config TEXMFSYSVAR /opt/texlive/2021/texmf-var TEXMFVAR ~/.texlive2021/texmf-var binary_x86_64-darwin 0 binary_x86_64-linux 1 binary_win32 0 option_doc 0 option_src 0 option_adjustrepo 0 余談ですが、この設定ファイルの書式、TeX Liveのリファレンスにも見つけられませんでした（一度デフォルト設定でビルドすると出力されるから、それを改変しろ。ということらしい。）
Dockerfile 本体となるDocekrfileです。 ベースにはmicrosoftが公開しているdevcontainer用に設定されたイメージを使用しました。 基本的なutil系コマンドがインストール済みです。
それ以降の処理はコメントに記載してあるとおりです。
FROMmcr.microsoft.com/vscode/devcontainers/base:ubuntu-21.04COPY tex.profile ./# 日本のミラーサーバからTeX Live 2021をダウンロードしてくるRUN wget https://texlive.texjp.org/2021/tlnet/install-tl-unx.tar.gz \ && mkdir install-tl \ && tar xzf install-tl-unx....</p></section><footer class=entry-footer><span title="2022-01-14 05:20:52 +0000 UTC">January 14, 2022</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;tbistr</footer><a class=entry-link aria-label="post link to texlive2021の最強環境を作ったよ" href=https://tbistr.github.io/posts/tech/tex_devcontainer/></a></article><article class=post-entry><header class=entry-header><h2>Vagrantでデスクトップ環境はいらないけど、GUIアプリを使いたい</h2></header><section class=entry-content><p>何がしたいか Vagrantで立てたVMについて、デスクトップ環境(GNOMEとかLXDEとか)を導入して、GUI環境を実現させる方法は様々な紹介されている。
しかし、デスクトップ環境の導入をすると、プロビジョニングのステップでapt-get install ubuntu-desktopなどする必要があり、めちゃめちゃ時間がかかる。
ここでは、VM内のアプリケーションをwindows上のウィンドウとして描画させることを目指す。
仕組み 用語 X Window System (X11) linuxがデファクトで使っている、ウィンドウ表示プロトコル。 X11クライアント 画面を描画してもらうアプリケーション。 今回の場合、ゲストOS上で動くアプリケーション。 X11サーバー 画面を描画する側。 今回の場合、ホストOSのウィンドウシステム。 vcXsrv 今回使うwindows向けX11サーバー。 X11サーバーは色々種類があるが、最近はこれが主流らしい。 実際の動き 下図のように、SSH経由で送信。 実践 準備 Chocolateyを使っているので、choco install vcxsrvでvcXsrvをインストール。
(https://sourceforge.net/projects/vcxsrv/ からもインストールできる)
起動すると設定項目が出る。 すべて初期設定で問題ない。
タスクバーにX11のロゴが出ていたら準備完了。(簡単！！！)
Vagrantファイルの用意 最終的に、以下のようなVagrantファイルを用意する。
Vagrant.configure("2") do |config| config.vm.box = "bento/ubuntu-20.10" config.ssh.forward_x11 = true config.vm.provision "shell", inline: &lt;&lt;-SHELL apt-get update apt-get upgrade SHELL config.vm.provision "shell", privileged: false, inline: &lt;&lt;-SHELL echo "export DISPLAY=10....</p></section><footer class=entry-footer><span title="2021-12-18 17:01:15 +0900 +0900">December 18, 2021</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;tbistr</footer><a class=entry-link aria-label="post link to Vagrantでデスクトップ環境はいらないけど、GUIアプリを使いたい" href=https://tbistr.github.io/posts/tech/vagrant_x11/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://tbistr.github.io/posts/page/2/>次のページ »</a></nav></footer></main><footer class=footer><span>&copy; 2022 <a href=https://tbistr.github.io/>Tbistr blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>